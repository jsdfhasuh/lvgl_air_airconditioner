# 驱动层

## 传感器
### LM75A
LM75A是温度-数字转换器，使用的I2C通信协议。
实际操作流程如下：
1.注册i2c_lm75_driver结构体
2.当设备树编写了lm75a节点的时候，会触发了lm75_driver结构体里面的probe函数，注册lm75a对应的lm75_ops和创建文件句柄
3.当对文件句柄进行操作的时候，就会调用lm75_ops的read函数。

### DHT11
DHT11是温度湿度传感器，使用的是单总线协议。
在驱动层面编写，调用的是linux驱动的gpio框架。将具体硬件部分代码和对应框架的代码分离开来，避免了复杂的重写。jsdfhasuh_cdev.c就是对接linux的字符设备驱动总线，而DHT11.c对接的是jsdfhasuh_cdev。
实际操作流程如下：
1.通过Linux的平台总线注册函数注册dht11_driver，给jsdfhasuh_cdev传递dht11_gpios指针，里面存放了业务端对应的函数指针。然后再调用jsdfhasuh_cdev的jsdfhasuh_register_chrdev来注册设备。
2.当对文件句柄进行操作的时候，就会从jsdfhasuh_cdev一直调用到DHT11.c。
遇到的困难如下：
1.内核抢占问题。因为发送开始信号和接受信号的间隔比较短，所以中间是需要进行中断的关闭，避免了其他程序对发送开始信号的程序的中断。
2.在考虑了抢占问题之后，返回的数据在部分时间仍然有问题，初步判断是传感器的问题。所以通过异步队列的方式，在不阻塞的情况，实现连续读取，错误的数据直接抛弃。
## 输出模块
### 28byj48步进电机
28byj48 是五线四相步进电机，不同相位得电会让步进电机的转子转动一个角度，按一定规律给不同的相位通电，就可以让步进电机连续转动。通过GPIO框架和中断实现这个步进电机的运转。
### at24存储芯片
AT24_C32 作为存储芯片，存储存放的数据。通过I2C总线挂靠到linux系统的I2C总线，通过NVMEM框架来实现控制和读取。



# 应用层

采用LVGL框架进行编写

## 输入模块
### 红外解码模块
红外解码模块与系统之间用串口通讯。实际操作：打开串口，设置波特率和奇偶校验，设置中断。
### LM75a和DHT11
对文件操作

## 输出模块
### 电机控制